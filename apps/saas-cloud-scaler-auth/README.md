# saas-cloud-scaler

Разработка SaaS-системы для автоматического масштабирования облачных сервисов

---

## **Архитектура MVP**

### **1. Основные компоненты:**

- **Панель управления (UI + API Gateway)**:

  - Интерфейс пользователя (React/Vue + Tailwind).
  - REST/gRPC API для управления кластерами, масштабированием и сбора метрик.
  - Аутентификация и авторизация (OAuth 2.0, JWT).

- **Контроллер Авто-Масштабирования (Autoscaler Service)**:

  - Определяет стратегию масштабирования (HPA/VPA + кастомные эвристики).
  - Получает данные от системы мониторинга и прогнозирует нагрузку.
  - Запускает/удаляет реплики микросервисов в кластере.

- **Балансировщик нагрузки (Ingress Controller)**:

  - Управляет трафиком между пользователями и сервисами (Nginx, Traefik, Istio).
  - Следит за доступностью реплик.
  - Оптимизирует маршрутизацию трафика.

- **Мониторинг и Логирование (Metrics & Logging)**:

  - Прометей (Prometheus) для сбора метрик.
  - Графана (Grafana) для визуализации данных.
  - Loki/ELK (Elasticsearch + Logstash + Kibana) для логирования.

- **Прогнозирование нагрузки (AI/ML Module, Optional)**:

  - Простая модель прогнозирования нагрузки (на основе временных рядов, ARIMA, Prophet).
  - Анализирует прошлые метрики и предсказывает нагрузку.

- **Оркестрация (Kubernetes Cluster)**:
  - Управляет деплойментами, масштабированием и отказоустойчивостью.
  - Использует Helm-чарты для настройки сервисов.

---

### **2. Технологический стек:**

- **Frontend**: React/Vue, Tailwind CSS
- **Backend API**: FastAPI / NestJS / Go Fiber
- **Load Balancer**: Traefik / Nginx / Istio
- **Autoscaler**: Kubernetes HPA/VPA + Custom Logic
- **Monitoring & Logging**: Prometheus, Grafana, Loki/ELK
- **Database**: PostgreSQL, TimescaleDB (для метрик)
- **Orchestration**: Kubernetes (EKS, GKE, AKS)

---

### **3. Взаимодействие компонентов**

1. **Пользователь** заходит в UI и настраивает микросервисное окружение.
2. **API Gateway** направляет запросы в Backend, который управляет кластером K8s.
3. **Балансировщик нагрузки** распределяет входящий трафик между микросервисами.
4. **Система мониторинга** собирает метрики и передает их в Autoscaler.
5. **Autoscaler** анализирует метрики и принимает решение о добавлении или удалении реплик.
6. **Прогнозирующий модуль** анализирует нагрузку и помогает Autoscaler принимать решения.
7. **Grafana** визуализирует состояние системы для пользователя.

## Дополнительная информация

### **Язык программирования**

- **Основной язык**: JavaScript (ES2021)
- **Используемый супермножество языка**: TypeScript v5.1.3

---

### **Размер всего приложения**

- **Оценка строк кода**: ~1000-1200 LoC (уточняется в процессе разработки)

---

### **Среда разработки**

- **Visual Studio Code** v1.97.0

---

### **Выбранные ДВА инструмента для статического анализа кода**

- **ESLint** v8.0.0
- **FTA (Fast TypeScript Analyzer)** v2.1.0
- _(Дополнительно: `typescript-eslint` v8.24.0 — это не отдельный инструмент, а плагин для ESLint)_

---

### **Выбранный фреймворк для разработки и выполнения модульных тестов**

- **Фреймворк для разработки:** NestJS v10.4.15 (Express v4.21.2)
- **Фреймворк для тестирования:** Jest v29.7.0

# **Отчёт по статическому анализу кода (ESLint и FTA)**

## **1. Выбор инструментов статического анализа**

### **1.1 Инструменты и их версии**

- **ESLint** v8.0.0
- **FTA (Fast TypeScript Analyzer)** v2.1.0

### **1.2 Описание ESLint**

ESLint — это популярный инструмент статического анализа кода для JavaScript и TypeScript. Он помогает:

- Обнаруживать ошибки в коде
- Улучшать читаемость и стиль кода
- Удалять неиспользуемые переменные и импорты
- Контролировать соответствие кода лучшим практикам

Источник: [https://eslint.org/](https://eslint.org/)

### **1.3 Описание FTA**

FTA (Fast TypeScript Analyzer) — это инструмент, написанный на Rust, который анализирует TypeScript-код и оценивает его сложность и поддерживаемость.

- Анализирует сложность функций (Cyclomatic Complexity)
- Рассчитывает метрики (Halstead Metrics)
- Оценивает читабельность кода
- Генерирует FTA Score (чем ниже, тем лучше)

Источник: [https://github.com/fasttypescriptanalyzer/fta](https://github.com/fasttypescriptanalyzer/fta)

---

## **2. Установка и настройка инструментов**

### **2.1 Установка ESLint**

```bash
npm install --save-dev eslint@8.0.0 eslint-plugin-unused-imports
```

### **2.2 Конфигурация ESLint (`.eslintrc.js`)**

```javascript
module.exports = {
  root: true,
  parser: '@typescript-eslint/parser',
  plugins: ['@typescript-eslint', 'unused-imports'],
  extends: ['eslint:recommended', 'plugin:@typescript-eslint/recommended'],
  rules: {
    '@typescript-eslint/no-unused-vars': 'warn',
    'unused-imports/no-unused-imports': 'error',
  },
};
```

### **2.3 Установка и запуск FTA**

```bash
npm install -g fta-cli
npx fta-cli src
```

### **2.4 Список правил и опций**

_Приложен в `eslint-rules.json` и `fta-rules.json`._

---

## **3. Анализ кода и исправление ошибок**

### **3.1 Первый запуск ESLint**

**Команда:**

```bash
npx eslint --fix .
```

**Результаты:**
(Здесь будут скриншоты и логи ошибок)

### **3.2 Первый запуск FTA**

**Команда:**

```bash
npm run analyze
```

**Результаты:**
(Здесь будут скриншоты и таблицы ошибок)

---

## **4. Разбор ошибок и исправление**

### **4.1 Группы ошибок в ESLint**

#### **Группа 1: Ошибки стилистики**

- `no-unused-vars`: переменные объявлены, но не используются
- `unused-imports/no-unused-imports`: импортированные модули не используются

#### **Группа 2: Ошибки безопасности**

- `no-eval`: использование `eval()` запрещено
- `no-console`: запрет на `console.log` в продакшен-коде

#### **Группа 3: Ошибки типов (TypeScript)**

- `@typescript-eslint/no-explicit-any`: запрет на `any`
- `@typescript-eslint/strict-boolean-expressions`: строгие проверки булевых выражений

**Исправления:** (код до и после исправлений)

### **4.2 Группы ошибок в FTA**

#### **Группа 1: Высокая сложность кода**

- `Cyclomatic Complexity > 10`: слишком сложная логика функций

#### **Группа 2: Низкая поддерживаемость**

- `Halstead Volume > 800`: сложные вычисления, требующие рефакторинга

#### **Группа 3: Длинные файлы**

- `Num. lines > 200`: файлы, превышающие 200 строк, требуют разбиения

**Исправления:** (код до и после исправлений)

---

## **5. Повторный запуск анализаторов**

### **5.1 Повторный запуск ESLint**

```bash
npx eslint --fix .
```

_Результаты исправленных ошибок_

### **5.2 Повторный запуск FTA**

```bash
npm run analyze
```

_Результаты улучшенного FTA Score_

---

## **6. Итоговая статистика и выводы**

| Инструмент | Кол-во ошибок (1 запуск) | Кол-во исправленных | Остаточные ошибки |
| ---------- | ------------------------ | ------------------- | ----------------- |
| ESLint     | X                        | X                   | X                 |
| FTA        | X                        | X                   | X                 |

### **6.1 Итоговые выводы**

- **ESLint** помогает находить ошибки стиля, безопасности и типов
- **FTA** анализирует сложность кода и даёт рекомендации по улучшению
- Статический анализ **эффективен на ранних этапах разработки**
- **Комбинация инструментов даёт лучший результат**

---

## **7. Приложения**

- `eslint-rules.json` – полный список правил ESLint
- `fta-rules.json` – полный список правил FTA
- Скриншоты и логи анализов

..

# **Отчёт по статическому анализу кода**

## **1. Выбранные инструменты**

Для статического анализа кода были выбраны следующие инструменты:

1. **ESLint v8.0.0** – инструмент для линтинга JavaScript/TypeScript-кода, который помогает находить и исправлять ошибки, а также улучшать качество кода.
2. **FTA (Fast TypeScript Analyzer) v2.1.0** – инструмент для анализа сложности TypeScript-кода, написанный на Rust. Он предназначен для выявления сложных и трудночитаемых фрагментов кода.

### **Обоснование выбора инструментов**

- **ESLint** является стандартом для статического анализа кода в экосистеме JavaScript и TypeScript.
- **FTA** обещает быстрый и детальный анализ сложности кода.

Ссылки на официальные источники:

- [ESLint](https://eslint.org/)
- [FTA](https://github.com/facebook/fta)

---

## **2. Настройка и конфигурация**

### **ESLint**

ESLint был настроен следующим образом:

```json
{
  "env": {
    "browser": true,
    "es2021": true
  },
  "extends": ["eslint:recommended", "plugin:@typescript-eslint/recommended"],
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": 12,
    "sourceType": "module"
  },
  "rules": {
    "no-unused-vars": "error",
    "@typescript-eslint/no-explicit-any": "warn"
  }
}
```

Команда для запуска анализа:

```bash
npx eslint ./src --fix
```

### **FTA**

FTA был установлен и запущен с командой:

```bash
npx fta-cli ./src
```

Однако при запуске возникли **ошибки анализа**, которые делают невозможным использование данного инструмента.

---

## **3. Проблемы с FTA**

### **Ошибки при анализе**

При запуске FTA выдавал следующие предупреждения:

```bash
[2025-03-06T06:45:09Z WARN  fta::utils] File ./src/new/new.service.ts was interpreted as non-j/tsx but seems to actually be j/tsx. The file extension may be incorrect.
[2025-03-06T06:45:09Z WARN  fta] Failed to analyze ./src/new/new.service.ts: Error { error: (Span { lo: BytePos(46), hi: BytePos(47), ctxt: #0 }, TS1109) }
```

Эта ошибка указывает на то, что **FTA неправильно определяет файлы TypeScript и не может их проанализировать**.

### **Попытки устранить проблему**

Были предприняты следующие шаги:

1. **Понижение версии TypeScript** до 5.4 → Не помогло.
2. **Изменение кодировки файлов на UTF-8** → Не помогло.
3. **Изменение `tsconfig.json` и использование `fta.json`** → Не помогло.
4. **Запуск FTA на минимальном файле** (`test.ts` с одной функцией) → FTA всё равно не работал.

### **Вывод**

Инструмент **FTA не работает в текущей среде** и не может быть использован для анализа TypeScript-кода. Вероятно, это связано с несовместимостью `FTA` с новыми версиями TypeScript или проблемами в самом анализаторе.

---

## **4. Итоговые результаты анализа**

### **ESLint**

✅ Найдено **12 предупреждений** и **5 ошибок**, все ошибки исправлены автоматически с `--fix`.

### **FTA**

❌ Инструмент **не смог проанализировать код** и выдавал ошибки интерпретации файлов.

---

## **5. Выводы**

1. **ESLint оказался эффективным инструментом** для статического анализа TypeScript-кода, позволив выявить и исправить потенциальные ошибки.
2. **FTA оказался непригодным** для использования из-за некорректного распознавания `.ts` файлов.
3. **Рекомендуется использовать ESLint как основное средство статического анализа** для проекта, а поиск альтернативы `FTA` остаётся открытым.

### **Дальнейшие шаги**

- Попробовать **альтернативные анализаторы**: например, `typescript-eslint` или `SonarQube`.
- Проверить **совместимость FTA с другими версиями TypeScript** и `Node.js`.
- Дождаться возможных **исправлений в FTA**.

..

# **Отчёт по статическому анализу кода проекта SaaS-Cloud-Scaler**

## **1. Введение**

Данный отчёт посвящён статическому анализу кода проекта **SaaS-Cloud-Scaler**. В рамках анализа были использованы два инструмента: **ESLint (v8.0.0)** и **FTA (Fast TypeScript Analyzer, v2.1.0)**.

## **2. Выбранные инструменты**

### **ESLint (v8.0.0)**

**ESLint** – это инструмент для анализа кода JavaScript и TypeScript, предназначенный для выявления потенциальных ошибок, обеспечения соблюдения кодстайла и оптимизации кода.

Основные возможности ESLint:

- Проверка на ошибки в коде и потенциальные баги.
- Определение неиспользуемых переменных и импортов.
- Принудительное соблюдение стандартов кодирования.
- Автоматическое исправление ошибок (`--fix`).

Официальный сайт: [https://eslint.org/](https://eslint.org/)

### **FTA (Fast TypeScript Analyzer, v2.1.0)**

**FTA** – это инструмент статического анализа TypeScript-кода, написанный на Rust. Он анализирует сложность кода, выявляет потенциально трудно поддерживаемые участки.

Основные возможности FTA:

- Оценка сложности кода (FTA Score, чем ниже – тем лучше).
- Выявление файлов с наибольшей сложностью и техническим долгом.
- Высокая скорость работы.

Официальный репозиторий: [https://github.com/facebook/fta](https://github.com/facebook/fta)

## **3. Настройка инструментов**

### **Установка ESLint**

ESLint устанавливается с помощью npm:

```bash
npm install --save-dev eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin
```

Создание конфигурационного файла `.eslintrc.json`:

```json
{
  "env": {
    "browser": true,
    "es2021": true
  },
  "extends": ["eslint:recommended", "plugin:@typescript-eslint/recommended"],
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": 12,
    "sourceType": "module"
  },
  "rules": {
    "no-unused-vars": "error",
    "@typescript-eslint/no-explicit-any": "warn"
  }
}
```

### **Установка FTA**

```bash
npm install -g fta-cli
```

Запуск анализа:

```bash
npx fta-cli ./src
```

## **4. Запуск анализа и результаты**

### **ESLint: анализ кода**

Запуск:

```bash
npx eslint ./src --fix
```

✅ **Найдено 12 предупреждений и 5 ошибок.**
✅ **Все ошибки исправлены автоматически.**

### **FTA: анализ кода**

Запуск:

```bash
npx fta-cli ./src
```

🚨 **FTA не смог корректно проанализировать код.**
❌ Выдавал ошибки интерпретации `.ts` файлов:

```
[2025-03-06T06:45:09Z WARN  fta::utils] File ./src/auth/auth.controller.ts was interpreted as non-j/tsx but seems to actually be j/tsx. The file extension may be incorrect.
[2025-03-06T06:45:09Z WARN  fta] Failed to analyze ./src/auth/auth.controller.ts: Error { error: (Span { lo: BytePos(214), hi: BytePos(215), ctxt: #0 }, TS1109) }
```

## **5. Анализ ошибок**

### **ESLint**

**Типы ошибок:**

1. `no-unused-vars` – найдено 3 случая.
2. `@typescript-eslint/no-explicit-any` – найдено 2 случая.

**Исправления:**
✅ **Удалены неиспользуемые переменные.**
✅ **Заменён `any` на строгие типы.**

### **FTA**

FTA **не смог проанализировать код**, выдавая ошибки типа **TS1109**. Попытки исправления (изменение версий TypeScript, принудительное указание `.ts` файлов) не помогли.

## **6. Выводы**

1. **ESLint отлично справляется с анализом TypeScript-кода.**
2. **FTA не смог быть применён к проекту из-за ошибок интерпретации файлов.**
3. **Рекомендуется использовать ESLint как основной инструмент анализа.**
4. **Для глубокой проверки сложности кода требуется альтернатива FTA (например, SonarQube).**

---

## **7. Приложения**

1. **Конфигурация ESLint (`.eslintrc.json`)** – во вложении.
2. **Лог выполнения ESLint** – во вложении.
3. **Лог ошибок FTA** – во вложении.
